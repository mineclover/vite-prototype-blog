---
date: 2023-05-01
modified: 2023-05-02
---

## API 키에 대해

- [ ] API 키 숨기는 방법 찾아보기
      [Part One: JWTs | Supabase Docs](https://supabase.com/docs/learn/auth-deep-dive/auth-deep-dive-jwts)
      나는 api 키를 더 잘 숨기고 싶다
      왜냐면 api 키는 탈취당할 수 있으니까

그래서 api 키의 갱신 주기를 낮춘다 브라우저 들어와서 쓰라고
그런데 그냥 api 가 노출되지 않는 건 안되는 걸까

서버리스 함수 실행 할 때 내부 로직 상으로만 관리해서 괜찮았던걸로 아는데..
기존 구조가
클라이언트 > 서버리스 (API 키) > 서버 > 서버리스 > 클라이언트
이런 구조여서 서버리스가 원하는 api 키를 받고 실행할 수 있느냐...

### 한 줄 요약

서버리스 경유해서 요청 주고 받고 싶다
api 키를 콘솔에서 찾을 수 없게 완전히 숨기기 위한 목적으로

### 추정하기

[API key shown in Network Tab · supabase · Discussion #256 · GitHub](https://github.com/orgs/supabase/discussions/256)
모든 사람이 일단 서버에 접속할 수 있는 API 키가 `anon` 키 이다
요청을 위해 post 안에 데이터가 들어가는 것인가 그렇다 하더라도 탈취되지 않나

그 답변으로 준 것도 시원찮다
[javascript - Is it safe to expose Firebase apiKey to the public? - Stack Overflow](https://stackoverflow.com/questions/37482366/is-it-safe-to-expose-firebase-apikey-to-the-public)

내가 생각하는 건 그 브라우저를 틀어만 놓고 콘솔로그에서 보내면 해당 경로에서 보낸 것이긴 하지 않나
또는 스크립트를 쭉 짜서 버튼을 만들어 넣고 그걸 클릭해도 해당 경로해서 보내긴 한 것이지 않나...

그래서 개발용 api 키와 서비스용 anon 를 따로 둔다고 하는데
서비스가 그 구분이 필요하지 않은 경우에 어떻게 제어하는 지 궁금하다

사용자가 구분된 경우 본인의 데이터에만 접속 가능하도록하고
권한에 속도와 횟수를 제한하는 방법을 제시한다고 한다
한마디로 좀 귀찮게 해라 라는 것으로 밖에 안들리긴 한다
상대가 악의적이라면 어떻게 제한해야하지? 라는 생각이 들었다

하지만 이 생각이 꼭 맞는 말인 것은 아니다

#### 몃가지 기능제공

user-agent 값에 따른 정책적 보안

특정 OS 로만 접속 가능하도록 하기 같은 것을 제안한다
그런데 리눅스로 컴퓨터 쓰는 사람이 있을 수도 있지..

그러니까 특정 OS 는 로봇테스트를 거치게 해보자
아니면 특정 트래픽 이상 서버에 요청을 보내면 정지하도록? 좀 애매하다

### 버셀의 서버리스

버셀은
본인과 같은 도메인의 서버로 전송 가능한 분리된 서버를 만들어서 그 서버를 경유해서 데이터를 전송하고 돌려받도록 하고 있어

전송과정에서 콘솔로그를 통해서 API 주소를 확인할 수가 없는 거지 왜냐면은 내부 서버를 통해서 데이터를 주고받게 해놨고
그거는 브라우저를 통해서 접속할 수 없는 서버로 지정을 해놨을 거니까

그런데 그렇다고 해도 아까 내가 말한 취약점 중의 하나인
콘솔 로그를 통한 데이터 전송 같은 경우에 그걸 어떻게 처리할 건지 궁금해진다
api 키가 없어서 직접은 못들어가지만 콘솔창으로는 되는 거 아닌가 라는 생각이 조금 든다 근데 실제로 되나?

> 한번 찍어봐야겠다

- [ ] 전송 값 확인해보기

console 창 api 요청 막히나

## 결론

supabase 는 통신을 위해 별도의 클래스를 제공한다
그리고 그건 어느정도 추상화가 되어있다 (이것만해도 진입장벽이 높아진다)

통신을 위해 객체를 import 받아야하고 그렇지 않다면 스크립트를 그대로 박아넣은 다음 브라우저에서 js 를 import 시키고 해야하는 등 굉장히 복잡해진다
그리고 정책을 통해 보호한다
이렇게 되면 브라우저에 접속 하긴 해야하는 게 된다

충분히 안전한 것 같다
